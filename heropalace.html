<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="keywords" content="伏魔道 官方论坛 绘影区 资料区 攻略区 英雄殿">
	<meta name="description" content="手机英雄殿">
    <meta name="author" content="heyanfang">
    <!-- <meta HTTP-EQUIV="Pragma" CONTENT="no-cache"> -->
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <meta name="viewport" content="width=640,user-scalable=no">
    <link rel="stylesheet" type="text/css" href="css/index.css">
	<title>伏魔道-英雄殿</title>
  <script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?957b410e98c03d9af173b293757195ef";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

</head>
<body class="herop">
	<div id="app" class="wrap">
    	<!-- banner begin -->
		<div class="banner">
		   <div class="back_but"><a href="index.html"><返回</a> </div>
            <div class="logo"></div>
            <!-- 下载按钮 -->
            <div class="down" title="下载"><a href="download.html"></a></div>
        </div>
          <!-- banner end -->
        <!--  conTent begin-->

        <div class="body_type">
        <!-- star_begin -->
         <ul class="star_bg">
        
           <!--  <li><img v-bind:src="img"/></li> -->
              <li v-for="n in star_num"><img  src="img/heroimg/star.png" /></li> 
         </ul>
         <!-- star_end -->
        <!-- 三种类型 -->
         <ul class="title3">
                <li class="tuji cur" onclick="clickHeroItem(this,'tujixing')"></li>
                <li class="fangyu" onclick="clickHeroItem(this,'fangyuxing')"></li>
                <li class="yuancheng" onclick="clickHeroItem(this,'yuanchengxing')"></li>
        </ul>
        <!-- 三种类型 end -->
         <div class="contents">
         <div class="content c1">
         	<div class="list_nav">
            <div class="talent_type">
            <!-- 滚动的img -->
            <div  class="touxiang">
                <ul class="touxiang" id="hero">
                    <li  v-for="hero in heros"  v-on:click="showDetail(hero.id, $event)">
                    <span v-if="checkHerlid===hero.id"></span>
                      <span v-else class="shadow"></span>
                       <img v-bind:src="hero.img" v-bind:alt="hreo.title" />
                    </li>
                </ul></div>
                 <!-- 滚动的img -->
            </div>
            </div>
             <!-- heor1 -->
           <!--  <div class="heor_info">   -->
            <!-- hero_bg begin -->
            <div class="heor_bg heor1">
                 <!-- 人物头像 -->
            <div class="img_bg" style="{{ hero_image | bgimg}}"><!-- <img v-bind:src="img_bg"> --><!-- {{img_bg}} --></div>
            <!-- 人物头像 -->
               <!-- 技能 -->
               <div class="tablent_total">
               <div class="talent">
               </div>
               <div class="tab_four">
                <ul class="title">
                    <li class="talentname1" v-for="jineng in jinengList"  v-on:click="showJinengIntro(jineng,$event)">
                     <div class="{{ jinengname | jinengClass jineng.name }}">
                        <img class="fir_talent " v-bind:src="jineng.img"/>
                        <i>{{jineng.name}}</i>
                     </div> 
                    </li>
                </ul>
                <ul class="cont">
                <span class="mark1 " v-text="jinengIntro">
                </span>
                </ul>
               </div>
               </div>
            <!-- 武器 -->
             <div class="wuqi" v-show="weapon_image">
             <div class="tianming">
             <div class="wuqi_img">
               <img v-bind:src="weapon_image" alt="" /></div>
                 <span class="tianmeng">{{ weapon_name }}</span></div>
               <div class="info_wuqi">
                 
                   <span class="tianmeng_info">
                     {{weapon_intro}}
                 </span>
               </div>
              </div>
       <!-- 奇缘 -->
         	  <div class="qiyuan">
               <div class="talent">
               </div>
               <div class="tab_three">

                <ul class="title">
                    <li class="talentname1" v-for="temp in qiyuanList"  v-on:click="showQiyuanIntro(temp)">
                    <div class="{{qiyuanname | jinengClass temp.id}}">
                        <img class="fir_talent" v-bind:src="temp.img"/>
                        <i>{{temp.name}}</i></div>
                    </li>
                </ul>
                <ul class="cont">
                <span class="mark " v-text="qiyuanIntro">

                </span>
              </ul>
               </div>
               </div>
             <!--  </div>   -->
              <!-- heor_bg end -->
              </div>
              <!-- heor1 -->
        </div>
         <!-- 中间三部分结束 -->
        </div>
        <div class="foot">
       <div >
       <div class="down_foot"><a href="download.html"></a></div>
        <p>
            Copyright © 2012 Hoolai Games. All Rights Reserved 互爱互动（北京）科技有限公司版权所有
        </p>
        </div>
        </div>
         </div>
        <!--  conTent end-->
	</div>
  <script type="text/javascript" src="js/jquery.min.js"></script>
  <script  src="js/vue.min.js"></script>
 <script type="text/javascript">
var resultList={};
var url = "http://games.hoolai.com/cms/?json=get_category_posts&cat=221&include=title,content,categories,custom_fields&count=10000";
var vm=new Vue({
  el: '#app' //指定vue在哪里开始
  ,data: {
    heros:[]
    ,jinengList:[]
    ,qiyuanList:[]
    ,jinengIntro:""
    ,qiyuanIntro:""
    ,qiyuanList:[]
    ,weapon_image:""
    ,weapon_intro:""
    ,weapon_name:""
    ,checkJI:""
    ,hero_image:""
    ,checkHerlid:0
    ,jinengname:""
    ,qiyuanname:""
    ,star_num:0
    ,styleObject: {

    }
  }
  ,methods:{ //hero_info data get
    showDetail: function(heroid,e){
       console.log(heroid);
      /*      $(e.toElement).closest("ul").find("span").addClass("shadow")
       $(e.toElement).prev().removeClass("shadow");*/
       bindHeroJineng(heroid); //

       bindHeroQiyuan(heroid);

       bindHeroWuqi(heroid);
     
       //  bindHeroIMG(heroid);
      // $(e).find("span").removeClass("shadow");
    }
    ,showJinengIntro:function(row){
      this.jinengIntro=row.intro;
      this.jinengname=row.name;
    }
    ,showQiyuanIntro:function(row){
      this.qiyuanIntro=row.intro;
      this.qiyuanname=row.id;

    }
  }
});

//vm.$data={};

$.post(url,function(result){

      resultList=result;

      bindData();

},"jsonp")


function clickHeroItem(e,key){
 
   $(e).parent().find("li").removeClass("cur");

   $(e).addClass("cur");

   getHeroData(key);

}
//第一次数据显示
function bindData(){

  getHeroData("tujixing");
 
}


var heroList=[];
var jinengList=[];
function getHeroData(key){
     if(!heroList[key]){ //三次key
       var posts= resultList.posts;
       var outList=[];
       for (var i = 0; i < posts.length; i++) {
           var post=posts[i];
           if(!checkCategories(key,post)){ continue;}; //不同类跳出
           var hero={};
           hero.id=post.id;
           hero.title=post.title;
           var custom_fields=post.custom_fields;
           hero.img=custom_fields.icon[0];


           var other={};
           other.jinengList=getJinengList(post);
           other.qiyuanList=getQiyuanList(post);

           try {
             other.star_num=(post.custom_fields.star_num)?post.custom_fields.star_num[0]:"";
             other.hero_image=(post.custom_fields.image_mobile)?post.custom_fields.image_mobile[0]:"";
            /* other.weapon_image=post.custom_fields.weapon_image[0];*/
             other.weapon_image=(post.custom_fields.weapon_image)?post.custom_fields.weapon_image[0]:"";
             other.weapon_name=(post.custom_fields.weapon_name)?post.custom_fields.weapon_name[0]:"";
             other.weapon_intro=(post.custom_fields.weapon_intro)?post.custom_fields.weapon_intro[0]:"";
            /* other.weapon_name=(post.custom_fields.weapon_name)?post.custom_fields.weapon_name[0]:"";*/

           } catch (e) {
              console.log(e);
           }
          /*  <div class="body_type">
        <!-- star_begin --><!--  v-show:"star.img" -->
         <ul class="star_bg" v-for="var in stars">
            <li v-for="n in star_num"><img  src="img/heroimg/star.png" /></li> 
         </ul>
         <!-- star_end -->*/
          /* if(other.star_num<=9){
            var $star=$('.body_type ul.star_bg li img').append('')
           }*/
           heroList[hero.id]=other;
           outList.push(hero);
           //outList[hero.id]=hero;
       }
       heroList[key]=outList;
    /*  var length=heroList[key].length;
      var $touxiang=$("div.body_type").find("div.contents .touxiang ul");  
      var $touli=$touxiang.find('li');
      $touxiang.css('width', (length+1)*134/2 + 'px');
      console.log(length);*/

    }
    vm.$data.heros=heroList[key]; //绑定英雄
      var length=heroList[key].length;
      var $touxiang=$("div.body_type").find("div.contents .touxiang ul");  
      var $touli=$touxiang.find('li');
      $touxiang.css('width', (length+1)*134/2 + 'px');
      console.log(length);
    var heroid=heroList[key][0].id;
    bindHeroJineng(heroid);

    bindHeroQiyuan(heroid);

    bindHeroWuqi(heroid);
  /*  bindHeroIMG(heroid);*/
}

function getJinengList(post){
  var jinengList=[];//技能
   for(var n=1;n<5;n++){
     var custom_fields=post.custom_fields;
     var temp={};
     try {
       // eval("jineng.img=custom_fields.skill"+n+"_image[0];");//original 计算某个字符串并执行其中的js代码
       // eval("jineng.name=custom_fields.skill"+n+"_name[0];");
       // eval("jineng.intro=custom_fields.skill"+n+"_intro[0];");
       var url="img/heroimg/img_h_14.jpg";
       eval("temp.img=(custom_fields.skill"+n+"_image)?custom_fields.skill"+n+"_image[0]:'';");
       eval("temp.intro=(custom_fields.skill"+n+"_intro)?custom_fields.skill"+n+"_intro[0]:'';");
       eval("temp.name=(custom_fields.skill"+n+"_name)?custom_fields.skill"+n+"_name[0]:'';");

       if(temp.img==""&&temp.intro==""&&temp.name==""){
          continue;
       }else{
          if(temp.img==""){
              temp.img=url;
          }
       }
       jinengList.push(temp);
     } catch (e) {

     } finally {

     }

   }
   return jinengList;

}

function getQiyuanList(post){
  var qiyuanList=[];//技能
   for(var n=1;n<4;n++){
     var custom_fields=post.custom_fields;
     var temp={};
     try {
       var url="img/heroimg/img_h_14.jpg";
       temp.id=n;
       eval("temp.img=(custom_fields.karma"+n+"_image)?custom_fields.karma"+n+"_image[0]:ur;");
       eval("temp.intro=(custom_fields.karma"+n+"_intro)?custom_fields.karma"+n+"_intro[0]:'';");
       eval("temp.name=(custom_fields.karma"+n+"_name)?custom_fields.karma"+n+"_name[0]:'';");
       qiyuanList.push(temp);
     } catch (e) {

     } finally {

     }
   }
   return qiyuanList;
}

function bindHeroJineng(heroid){
    var jinengList=heroList[heroid].jinengList;
    vm.$data.jinengList=jinengList;
    vm.$data.jinengIntro=jinengList[0].intro;

     vm.$data.jinengname=jinengList[0].name;
}

function bindHeroQiyuan(heroid){
  var qiyuanList=heroList[heroid].qiyuanList;
  vm.$data.qiyuanList=qiyuanList;
  vm.$data.qiyuanIntro=qiyuanList[0].intro;
  vm.$data.qiyuanname=qiyuanList[0].id;
}

function bindHeroWuqi(heroid) {
/*  $wuqi=$(content).*/

  var other=heroList[heroid];  
/*  if(other.weapon_image!=undefined){*/
  vm.$data.weapon_image=other.weapon_image;
  vm.$data.weapon_intro=other.weapon_intro;
  vm.$data.weapon_name=other.weapon_name;
   vm.$data.hero_image=other.hero_image;
   vm.$data.star_num=Number(other.star_num);
 /*} else{
    $wuqi.remove();
  }*/
  vm.$data.checkHerlid=heroid;
  vm.$data.checkJI=heroid;
}
/*function bindHeroIMG(heroid){
    var other=heroList[heroid];
  vm.$data.img_bg=other.img_bg;

}*/
function checkCategories(key,post){
    var categories=post.categories;
    for (var i = 0; i < categories.length; i++) {
          var data=categories[i];
          if(data.slug==key){
            return true;
          }
    }
    return false;
}
 //过滤器
Vue.filter('bgimg',function(img){
  if(img){return 'background:url('+img+')no-repeat';}
})
Vue.filter('jinengClass', function (value,oldname) {
  if(value===oldname){
    return "jineng";
  }else{
    return "";
  } 
})

// 计算头像区的宽度
/*
*/
 </script>
</body>
</html>
